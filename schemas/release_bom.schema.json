{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "release_bom_schema_v1",
  "schema_version": "release_bom_schema_v1",
  "title": "Release BOM Schema",
  "type": "object",
  "additionalProperties": false,
  "required": ["version", "artifacts", "provenance"],
  "properties": {
    "version": {
      "type": "integer",
      "const": 1
    },
    "release_tag": {
      "type": ["string", "null"],
      "pattern": "^v\\d+\\.\\d+\\.\\d+$"
    },
    "artifacts": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "release_bom_schema",
        "release_audit_failure_schema",
        "openapi_release_gate_result_schema",
        "release_bom_consistency_result_schema",
        "release_bom_generator_gate_result_schema",
        "release_gate_envelope_schema",
        "schema_graph_bundle_schema",
        "openapi_breaking_policy",
        "openapi_before_snapshot",
        "openapi_after_snapshot",
        "openapi_diff_report",
        "openapi_classifier_manifest"
      ],
      "properties": {
        "release_bom_schema": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "path", "schema_version", "$id",
            "canonical_sha256", "canonical_sha256_short",
            "ref_closure", "ref_closure_sha256",
            "ref_edges", "ref_edges_sha256"
          ],
          "properties": {
            "path": { "type": "string", "pattern": "^dist/release_bom\\.schema\\.json$" },
            "schema_version": { "type": "string", "minLength": 1 },
            "$id": { "type": "string", "minLength": 1 },
            "canonical_sha256": { "$ref": "#/$defs/sha256" },
            "canonical_sha256_short": { "$ref": "#/$defs/sha12" },
            "ref_closure": { "$ref": "schema_graph_bundle.schema.json#/properties/ref_closure" },
            "ref_closure_sha256": { "$ref": "#/$defs/sha256" },
            "ref_edges": { "$ref": "schema_graph_bundle.schema.json#/properties/ref_edges" },
            "ref_edges_sha256": { "$ref": "#/$defs/sha256" }
          }
        },
        "release_audit_failure_schema": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "path", "schema_version", "$id",
            "canonical_sha256", "canonical_sha256_short",
            "ref_closure", "ref_closure_sha256",
            "ref_edges", "ref_edges_sha256"
          ],
          "properties": {
            "path": { "type": "string", "pattern": "^dist/release_audit_failure\\.schema\\.json$" },
            "schema_version": { "type": "string", "minLength": 1 },
            "$id": { "type": "string", "minLength": 1 },
            "canonical_sha256": { "$ref": "#/$defs/sha256" },
            "canonical_sha256_short": { "$ref": "#/$defs/sha12" },
            "ref_closure": { "$ref": "schema_graph_bundle.schema.json#/properties/ref_closure" },
            "ref_closure_sha256": { "$ref": "#/$defs/sha256" },
            "ref_edges": { "$ref": "schema_graph_bundle.schema.json#/properties/ref_edges" },
            "ref_edges_sha256": { "$ref": "#/$defs/sha256" }
          }
        },
        "openapi_release_gate_result_schema": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "path", "schema_version", "$id",
            "canonical_sha256", "canonical_sha256_short",
            "ref_closure", "ref_closure_sha256",
            "ref_edges", "ref_edges_sha256"
          ],
          "properties": {
            "path": { "type": "string", "pattern": "^dist/openapi_release_gate_result\\.schema\\.json$" },
            "schema_version": { "type": "string", "minLength": 1 },
            "$id": { "type": "string", "minLength": 1 },
            "canonical_sha256": { "$ref": "#/$defs/sha256" },
            "canonical_sha256_short": { "$ref": "#/$defs/sha12" },
            "ref_closure": { "$ref": "schema_graph_bundle.schema.json#/properties/ref_closure" },
            "ref_closure_sha256": { "$ref": "#/$defs/sha256" },
            "ref_edges": { "$ref": "schema_graph_bundle.schema.json#/properties/ref_edges" },
            "ref_edges_sha256": { "$ref": "#/$defs/sha256" }
          }
        },
        "release_bom_consistency_result_schema": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "path", "schema_version", "$id",
            "canonical_sha256", "canonical_sha256_short",
            "ref_closure", "ref_closure_sha256",
            "ref_edges", "ref_edges_sha256"
          ],
          "properties": {
            "path": { "type": "string", "pattern": "^dist/release_bom_consistency_result\\.schema\\.json$" },
            "schema_version": { "type": "string", "minLength": 1 },
            "$id": { "type": "string", "minLength": 1 },
            "canonical_sha256": { "$ref": "#/$defs/sha256" },
            "canonical_sha256_short": { "$ref": "#/$defs/sha12" },
            "ref_closure": { "$ref": "schema_graph_bundle.schema.json#/properties/ref_closure" },
            "ref_closure_sha256": { "$ref": "#/$defs/sha256" },
            "ref_edges": { "$ref": "schema_graph_bundle.schema.json#/properties/ref_edges" },
            "ref_edges_sha256": { "$ref": "#/$defs/sha256" }
          }
        },
        "release_bom_generator_gate_result_schema": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "path", "schema_version", "$id",
            "canonical_sha256", "canonical_sha256_short",
            "ref_closure", "ref_closure_sha256",
            "ref_edges", "ref_edges_sha256"
          ],
          "properties": {
            "path": { "type": "string", "pattern": "^dist/release_bom_generator_gate_result\\.schema\\.json$" },
            "schema_version": { "type": "string", "minLength": 1 },
            "$id": { "type": "string", "minLength": 1 },
            "canonical_sha256": { "$ref": "#/$defs/sha256" },
            "canonical_sha256_short": { "$ref": "#/$defs/sha12" },
            "ref_closure": { "$ref": "schema_graph_bundle.schema.json#/properties/ref_closure" },
            "ref_closure_sha256": { "$ref": "#/$defs/sha256" },
            "ref_edges": { "$ref": "schema_graph_bundle.schema.json#/properties/ref_edges" },
            "ref_edges_sha256": { "$ref": "#/$defs/sha256" }
          }
        },
        "release_gate_envelope_schema": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "path", "schema_version", "$id",
            "canonical_sha256", "canonical_sha256_short",
            "ref_closure", "ref_closure_sha256",
            "ref_edges", "ref_edges_sha256"
          ],
          "properties": {
            "path": { "type": "string", "pattern": "^dist/release_gate_envelope\\.schema\\.json$" },
            "schema_version": { "type": "string", "minLength": 1 },
            "$id": { "type": "string", "minLength": 1 },
            "canonical_sha256": { "$ref": "#/$defs/sha256" },
            "canonical_sha256_short": { "$ref": "#/$defs/sha12" },
            "ref_closure": { "$ref": "schema_graph_bundle.schema.json#/properties/ref_closure" },
            "ref_closure_sha256": { "$ref": "#/$defs/sha256" },
            "ref_edges": { "$ref": "schema_graph_bundle.schema.json#/properties/ref_edges" },
            "ref_edges_sha256": { "$ref": "#/$defs/sha256" }
          }
        },
        "schema_graph_bundle_schema": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "path", "schema_version", "$id",
            "canonical_sha256", "canonical_sha256_short",
            "ref_closure", "ref_closure_sha256",
            "ref_edges", "ref_edges_sha256"
          ],
          "properties": {
            "path": { "type": "string", "pattern": "^dist/schema_graph_bundle\\.schema\\.json$" },
            "schema_version": { "type": "string", "minLength": 1 },
            "$id": { "type": "string", "minLength": 1 },
            "canonical_sha256": { "$ref": "#/$defs/sha256" },
            "canonical_sha256_short": { "$ref": "#/$defs/sha12" },
            "ref_closure": { "$ref": "schema_graph_bundle.schema.json#/properties/ref_closure" },
            "ref_closure_sha256": { "$ref": "#/$defs/sha256" },
            "ref_edges": { "$ref": "schema_graph_bundle.schema.json#/properties/ref_edges" },
            "ref_edges_sha256": { "$ref": "#/$defs/sha256" }
          }
        },
        "openapi_breaking_policy": {
          "type": "object",
          "additionalProperties": false,
          "required": ["path", "sha256", "sha256_short"],
          "properties": {
            "path": { "type": "string", "minLength": 1 },
            "sha256": { "$ref": "#/$defs/sha256" },
            "sha256_short": { "$ref": "#/$defs/sha12" }
          }
        },
        "openapi_before_snapshot": {
          "type": "object",
          "additionalProperties": false,
          "required": ["path", "sha256", "sha256_short"],
          "properties": {
            "path": { "type": "string", "pattern": "^(dist/)?openapi_before\\.json$" },
            "sha256": { "$ref": "#/$defs/sha256" },
            "sha256_short": { "$ref": "#/$defs/sha12" }
          }
        },
        "openapi_after_snapshot": {
          "type": "object",
          "additionalProperties": false,
          "required": ["path", "sha256", "sha256_short"],
          "properties": {
            "path": { "type": "string", "pattern": "^(dist/)?openapi_after\\.json$" },
            "sha256": { "$ref": "#/$defs/sha256" },
            "sha256_short": { "$ref": "#/$defs/sha12" }
          }
        },
        "openapi_diff_report": {
          "type": "object",
          "additionalProperties": false,
          "required": ["path", "sha256", "sha256_short"],
          "properties": {
            "path": { "type": "string", "minLength": 1 },
            "sha256": { "$ref": "#/$defs/sha256" },
            "sha256_short": { "$ref": "#/$defs/sha12" }
          }
        },
        "openapi_classifier_manifest": {
          "type": "object",
          "additionalProperties": false,
          "required": ["path", "sha256", "sha256_short", "selected"],
          "properties": {
            "path": { "type": "string", "pattern": "^(dist/)?openapi_classifier_manifest\\.json$" },
            "sha256": { "$ref": "#/$defs/sha256" },
            "sha256_short": { "$ref": "#/$defs/sha12" },
            "selected": {
              "type": "object",
              "additionalProperties": false,
              "required": [
                "openapi_classifier_version",
                "closure_file_count",
                "closure_files",
                "closure_graph_edges_sha256",
                "closure_graph_edges_sha256_short",
                "files_ast_sha256"
              ],
              "properties": {
                "openapi_classifier_version": { "type": "string", "minLength": 1 },
                "closure_file_count": { "type": "integer", "minimum": 1 },
                "closure_files": {
                  "type": "array",
                  "minItems": 1,
                  "items": { "type": "string", "minLength": 1 }
                },
                "closure_graph_edges_sha256": { "$ref": "#/$defs/sha256" },
                "closure_graph_edges_sha256_short": { "$ref": "#/$defs/sha12" },
                "files_ast_sha256": {
                  "type": "object",
                  "minProperties": 1,
                  "additionalProperties": { "$ref": "#/$defs/sha256" }
                }
              }
            }
          }
        }
      }
    },
    "provenance": {
      "type": "object",
      "additionalProperties": true,
      "required": [
        "baseline_tag",
        "current_tag",
        "breaking",
        "policy_sha256"
      ],
      "properties": {
        "baseline_tag": { "type": ["string", "null"] },
        "current_tag": { "type": ["string", "null"] },
        "breaking": { "type": "boolean" },
        "breaking_count": { "type": "integer", "minimum": 0 },
        "non_breaking_count": { "type": "integer", "minimum": 0 },
        "unknown_count": { "type": "integer", "minimum": 0 },
        "policy_sha256": {
          "type": ["string", "null"],
          "pattern": "^[a-f0-9]{64}$"
        },
        "classifier_fingerprint": { "type": "object" }
      }
    }
  },
  "$defs": {
    "sha256": {
      "type": "string",
      "pattern": "^[a-f0-9]{64}$"
    },
    "sha12": {
      "type": "string",
      "pattern": "^[a-f0-9]{12}$"
    }
  }
}
