{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "release_bom_schema_v1",
  "schema_version": "release_bom_schema_v1",
  "title": "Release BOM Schema",
  "type": "object",
  "additionalProperties": false,
  "required": ["version", "release_tag", "artifacts", "provenance"],
  "properties": {
    "version": {
      "type": "integer",
      "const": 1
    },
    "release_tag": {
      "type": ["string", "null"],
      "pattern": "^v\\d+\\.\\d+\\.\\d+$"
    },
    "artifacts": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "release_bom_schema",
        "release_audit_failure_schema",
        "openapi_breaking_policy",
        "openapi_before_snapshot",
        "openapi_after_snapshot",
        "openapi_diff_report",
        "openapi_classifier_manifest"
      ],
      "properties": {
        "release_bom_schema": {
          "type": "object",
          "additionalProperties": false,
          "required": ["path", "schema_version", "$id", "canonical_sha256", "canonical_sha256_short"],
          "properties": {
            "path": { "type": "string", "pattern": "^dist/release_bom\\.schema\\.json$" },
            "schema_version": { "type": "string", "minLength": 1 },
            "$id": { "type": "string", "minLength": 1 },
            "canonical_sha256": {
              "type": "string",
              "pattern": "^[a-f0-9]{64}$"
            },
            "canonical_sha256_short": {
              "type": "string",
              "pattern": "^[a-f0-9]{12}$"
            }
          }
        },
        "release_audit_failure_schema": {
          "type": "object",
          "additionalProperties": false,
          "required": ["path", "schema_version", "$id", "canonical_sha256", "canonical_sha256_short"],
          "properties": {
            "path": { "type": "string", "pattern": "^dist/release_audit_failure\\.schema\\.json$" },
            "schema_version": { "type": "string", "minLength": 1 },
            "$id": { "type": "string", "minLength": 1 },
            "canonical_sha256": {
              "type": "string",
              "pattern": "^[a-f0-9]{64}$"
            },
            "canonical_sha256_short": {
              "type": "string",
              "pattern": "^[a-f0-9]{12}$"
            }
          }
        },
        "openapi_breaking_policy": {
          "type": "object",
          "additionalProperties": false,
          "required": ["path", "sha256", "sha256_short"],
          "properties": {
            "path": { "type": "string", "minLength": 1 },
            "sha256": { "type": "string", "pattern": "^[a-f0-9]{64}$" },
            "sha256_short": { "type": "string", "pattern": "^[a-f0-9]{12}$" }
          }
        },
        "openapi_before_snapshot": {
          "type": "object",
          "additionalProperties": false,
          "required": ["path", "sha256", "sha256_short"],
          "properties": {
            "path": { "type": "string", "pattern": "^dist/openapi_before\\.json$" },
            "sha256": { "type": "string", "pattern": "^[a-f0-9]{64}$" },
            "sha256_short": { "type": "string", "pattern": "^[a-f0-9]{12}$" }
          }
        },
        "openapi_after_snapshot": {
          "type": "object",
          "additionalProperties": false,
          "required": ["path", "sha256", "sha256_short"],
          "properties": {
            "path": { "type": "string", "pattern": "^dist/openapi_after\\.json$" },
            "sha256": { "type": "string", "pattern": "^[a-f0-9]{64}$" },
            "sha256_short": { "type": "string", "pattern": "^[a-f0-9]{12}$" }
          }
        },
        "openapi_diff_report": {
          "type": "object",
          "additionalProperties": false,
          "required": ["path", "sha256"],
          "properties": {
            "path": { "type": "string", "minLength": 1 },
            "sha256": {
              "type": "string",
              "pattern": "^[a-f0-9]{64}$"
            }
          }
        },
        "openapi_classifier_manifest": {
          "type": "object",
          "additionalProperties": false,
          "required": ["path", "sha256", "sha256_short", "selected"],
          "properties": {
            "path": { "type": "string", "pattern": "^dist/openapi_classifier_manifest\\.json$" },
            "sha256": {
              "type": "string",
              "pattern": "^[a-f0-9]{64}$"
            },
            "sha256_short": {
              "type": "string",
              "pattern": "^[a-f0-9]{12}$"
            },
            "selected": {
              "type": "object",
              "additionalProperties": false,
              "required": [
                "openapi_classifier_version",
                "closure_file_count",
                "closure_files",
                "closure_graph_edges_sha256",
                "closure_graph_edges_sha256_short",
                "files_ast_sha256"
              ],
              "properties": {
                "openapi_classifier_version": { "type": "string", "minLength": 1 },
                "closure_file_count": { "type": "integer", "minimum": 1 },
                "closure_files": {
                  "type": "array",
                  "minItems": 1,
                  "items": { "type": "string", "minLength": 1 }
                },
                "closure_graph_edges_sha256": {
                  "type": "string",
                  "pattern": "^[a-f0-9]{64}$"
                },
                "closure_graph_edges_sha256_short": {
                  "type": "string",
                  "pattern": "^[a-f0-9]{12}$"
                },
                "files_ast_sha256": {
                  "type": "object",
                  "minProperties": 1,
                  "additionalProperties": {
                    "type": "string",
                    "pattern": "^[a-f0-9]{64}$"
                  }
                }
              }
            }
          }
        }
      }
    },
    "provenance": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "baseline_tag",
        "current_tag",
        "policy_path",
        "policy_sha256",
        "before_openapi_path",
        "before_openapi_sha256",
        "after_openapi_path",
        "after_openapi_sha256"
      ],
      "properties": {
        "baseline_tag": { "type": ["string", "null"] },
        "current_tag": { "type": ["string", "null"] },
        "policy_path": { "type": ["string", "null"] },
        "policy_sha256": {
          "type": ["string", "null"],
          "pattern": "^[a-f0-9]{64}$"
        },
        "before_openapi_path": { "type": ["string", "null"] },
        "before_openapi_sha256": {
          "type": ["string", "null"],
          "pattern": "^[a-f0-9]{64}$"
        },
        "after_openapi_path": { "type": ["string", "null"] },
        "after_openapi_sha256": {
          "type": ["string", "null"],
          "pattern": "^[a-f0-9]{64}$"
        }
      }
    }
  }
}
